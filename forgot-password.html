<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>忘记密码 - 单词记忆系统</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Tailwind CSS 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6', // 蓝色作为主色调
                        secondary: '#1D4ED8', // 深蓝色作为次要色调
                        accent: '#F59E0B', // 橙色作为强调色
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    transitionProperty: {
                        'all-300': 'all 0.3s ease',
                    },
                },
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .bg-gradient-primary {
                background: linear-gradient(135deg, #3B82F6 0%, #1D4ED8 100%);
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .card-hover {
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            .card-hover:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            }
        }
    </style>
    
    <style>
        /* 基础样式 */
        body {
            background-color: #F9FAFB;
        }
        
        /* 输入框聚焦效果 */
        input:focus {
            outline: none;
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* 平滑滚动 */
        html {
            scroll-behavior: smooth;
        }
        
        /* 动画效果 */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
    <!-- 页面头部 -->
    <header class="py-4 px-6 bg-white dark:bg-gray-900 border-b border-gray-200 dark:border-gray-800">
        <div class="container mx-auto flex items-center justify-between">
            <a href="word-memorization.html" class="flex items-center space-x-2">
                <i class="fa fa-book text-primary text-2xl"></i>
                <span class="text-xl font-bold text-gray-800 dark:text-white">单词记忆系统</span>
            </a>
            <nav>
                <ul class="flex space-x-6">
                    <li><a href="login.html" class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors">登录</a></li>
                    <li><a href="register.html" class="text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors">注册</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- 主内容区域 -->
    <main class="flex-grow flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8">
        <div class="max-w-md w-full space-y-8 bg-white dark:bg-gray-800 p-8 rounded-xl shadow-lg animate-fadeIn">
            <div class="text-center">
                <h2 class="text-3xl font-extrabold text-gray-900 dark:text-white">
                    找回您的账户
                </h2>
                <p class="mt-2 text-sm text-gray-600 dark:text-gray-400">
                    请按照以下步骤重置您的密码
                </p>
            </div>

            <!-- 步骤指示器 -->
            <div class="flex items-center justify-between mb-8">
                <div class="flex flex-col items-center">
                    <div id="step1-indicator" class="w-10 h-10 rounded-full bg-primary text-white flex items-center justify-center font-bold">1</div>
                    <span class="mt-2 text-xs text-gray-500 dark:text-gray-400">验证用户</span>
                </div>
                <div class="flex-grow h-1 mx-4 bg-gray-200 dark:bg-gray-700">
                    <div id="progress-bar" class="h-full w-0 bg-primary transition-all duration-500"></div>
                </div>
                <div class="flex flex-col items-center">
                    <div id="step2-indicator" class="w-10 h-10 rounded-full bg-gray-300 dark:bg-gray-700 text-gray-600 dark:text-gray-300 flex items-center justify-center font-bold">2</div>
                    <span class="mt-2 text-xs text-gray-500 dark:text-gray-400">设置新密码</span>
                </div>
            </div>

            <!-- 步骤1: 验证用户 -->
            <div id="step1" class="space-y-6">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">用户名</label>
                    <div class="relative rounded-md shadow-sm">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                            <i class="fa fa-user"></i>
                        </span>
                        <input id="username" name="username" type="text" required
                            class="pl-10 block w-full py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white rounded-lg focus:ring-primary focus:border-primary transition-all-300"
                            placeholder="请输入您的用户名">
                    </div>
                </div>

                <div>
                    <button id="verifyUserBtn" type="button"
                        class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg 
                               transition-all-300 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center">
                        <i class="fa fa-check-circle mr-2"></i> 验证用户
                    </button>
                </div>
            </div>

            <!-- 步骤2: 设置新密码 (初始隐藏) -->
            <div id="step2" class="space-y-6 hidden">
                <div>
                    <label for="newPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">新密码</label>
                    <div class="relative rounded-md shadow-sm">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                            <i class="fa fa-lock"></i>
                        </span>
                        <input id="newPassword" name="newPassword" type="password" required
                            class="pl-10 pr-10 block w-full py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white rounded-lg focus:ring-primary focus:border-primary transition-all-300"
                            placeholder="请设置新密码">
                        <button id="toggleNewPassword" type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-500">
                            <i class="fa fa-eye-slash"></i>
                        </button>
                    </div>
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">密码至少包含8个字符</p>
                </div>

                <div>
                    <label for="confirmPassword" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">确认新密码</label>
                    <div class="relative rounded-md shadow-sm">
                        <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
                            <i class="fa fa-lock"></i>
                        </span>
                        <input id="confirmPassword" name="confirmPassword" type="password" required
                            class="pl-10 pr-10 block w-full py-3 border border-gray-300 dark:border-gray-600 dark:bg-gray-900 dark:text-white rounded-lg focus:ring-primary focus:border-primary transition-all-300"
                            placeholder="请再次输入新密码">
                        <button id="toggleConfirmPassword" type="button" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-500">
                            <i class="fa fa-eye-slash"></i>
                        </button>
                    </div>
                </div>

                <div>
                    <button id="resetPasswordBtn" type="button"
                        class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg 
                               transition-all-300 transform hover:scale-[1.02] active:scale-[0.98] flex items-center justify-center">
                        <i class="fa fa-refresh mr-2"></i> 重置密码
                    </button>
                </div>
            </div>

            <!-- 返回登录按钮 -->
            <div class="text-center">
                <a href="login.html" class="text-sm font-medium text-primary hover:text-secondary transition-colors">
                    <i class="fa fa-arrow-left mr-1"></i> 返回登录
                </a>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="py-6 px-4 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800">
        <div class="container mx-auto text-center">
            <p class="text-sm text-gray-500 dark:text-gray-400">
                &copy; 2023 单词记忆系统. 保留所有权利.
            </p>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        // 存储当前验证的用户信息
        let currentUser = {
            index: -1,
            username: '',
            oldPassword: ''
        };
        
        // 密码显示/隐藏功能
        const toggleNewPassword = document.getElementById('toggleNewPassword');
        const newPassword = document.getElementById('newPassword');
        const toggleConfirmPassword = document.getElementById('toggleConfirmPassword');
        const confirmPassword = document.getElementById('confirmPassword');
        
        toggleNewPassword.addEventListener('click', function() {
            // 切换密码类型
            const type = newPassword.getAttribute('type') === 'password' ? 'text' : 'password';
            newPassword.setAttribute('type', type);
            
            // 切换图标
            this.querySelector('i').classList.toggle('fa-eye');
            this.querySelector('i').classList.toggle('fa-eye-slash');
        });
        
        toggleConfirmPassword.addEventListener('click', function() {
            // 切换密码类型
            const type = confirmPassword.getAttribute('type') === 'password' ? 'text' : 'password';
            confirmPassword.setAttribute('type', type);
            
            // 切换图标
            this.querySelector('i').classList.toggle('fa-eye');
            this.querySelector('i').classList.toggle('fa-eye-slash');
        });
        
        // 验证用户按钮点击事件
        const verifyUserBtn = document.getElementById('verifyUserBtn');
        verifyUserBtn.addEventListener('click', function() {
            const username = document.getElementById('username').value.trim();
            
            if (!username) {
                alert('请输入用户名');
                return;
            }
            
            // 获取注册用户列表
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            
            // 查找用户是否存在
            const userIndex = registeredUsers.findIndex(user => user.username === username);
            
            if (userIndex !== -1) {
                // 用户存在，保存用户信息和当前密码
                currentUser = {
                    index: userIndex,
                    username: username,
                    oldPassword: registeredUsers[userIndex].password
                };
                
                // 切换到步骤2
                document.getElementById('step1').classList.add('hidden');
                document.getElementById('step2').classList.remove('hidden');
                
                // 更新步骤指示器
                document.getElementById('step1-indicator').classList.remove('bg-primary');
                document.getElementById('step1-indicator').classList.add('bg-green-500');
                document.getElementById('step2-indicator').classList.remove('bg-gray-300', 'dark:bg-gray-700');
                document.getElementById('step2-indicator').classList.add('bg-primary');
                
                // 更新进度条
                document.getElementById('progress-bar').style.width = '100%';
                
                // 滚动到顶部
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                // 检查预设测试账号
                const validAccounts = [
                    { username: 'test', password: '123456' },
                    { username: 'admin', password: 'admin123' }
                ];
                
                const testAccount = validAccounts.find(account => account.username === username);
                
                if (testAccount) {
                    alert('测试账号不能修改密码，密码为: ' + testAccount.password);
                } else {
                    alert('未找到该用户，请检查用户名是否正确。');
                }
            }
        });
        
        // 重置密码按钮点击事件
        const resetPasswordBtn = document.getElementById('resetPasswordBtn');
        resetPasswordBtn.addEventListener('click', function() {
            const newPass = document.getElementById('newPassword').value;
            const confirmPass = document.getElementById('confirmPassword').value;
            
            // 密码验证
            if (!newPass || newPass.length < 8) {
                alert('密码至少包含8个字符');
                return;
            }
            
            if (newPass === currentUser.oldPassword) {
                alert('新密码不能与之前的密码相同，请设置不同的密码');
                return;
            }
            
            if (newPass !== confirmPass) {
                alert('两次输入的密码不一致');
                return;
            }
            
            // 获取注册用户列表
            const registeredUsers = JSON.parse(localStorage.getItem('registeredUsers')) || [];
            
            // 更新用户密码
            if (currentUser && currentUser.index !== -1) {
                registeredUsers[currentUser.index].password = newPass;
                localStorage.setItem('registeredUsers', JSON.stringify(registeredUsers));
                
                // 显示成功消息
                alert('密码重置成功！请使用新密码登录。');
                
                // 跳转到登录页面
                window.location.href = 'login.html';
            } else {
                alert('用户信息丢失，请重新验证用户。');
            }
        });
        
        // 输入框聚焦时的额外动效
        const inputs = document.querySelectorAll('input');
        
        inputs.forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.classList.add('scale-[1.02]');
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.classList.remove('scale-[1.02]');
            });
        });
        
        // 支持深色模式检测
        function checkDarkMode() {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.classList.add('dark');
            }
        }
        
        // 初始化检查深色模式
        checkDarkMode();
        
        // 监听深色模式变化
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', checkDarkMode);
    </script>
</body>
</html>